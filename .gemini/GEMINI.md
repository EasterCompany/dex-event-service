## Project Architecture & Constraints
- **Project Structure (Dec 2025):**
    - `dex-cli/` (Go): CLI management tool.
    - `dex-discord-service/` (Go): Discord bot, audio streaming, and VAD.
    - `dex-event-service/` (Go): Core event bus, storage, and handlers.
    - `dex-tts-service/` (Python/Go Wrapper): High-quality Text-to-Speech (XTTS-v2).
    - `dex-web-service/` (Go): Headless browser and metadata extraction.
    - `easter.company/` (HTML/JS): Frontend dashboard.
- **Restricted Channels:**
    - Channels `1437617331529580614` (music) and `1381915374181810236` (memes) are designated for analysis and moderation only. 
    - Dexter should explicitly avoid replying or engaging in these channels unless specifically mentioned.

## Analyst & Notifications System (Dec 2025)
- **Objective:** Establish a robust infrastructure for proactive AI insights and architectural "Blueprints."
- **Analyst Worker:**
    - **Trigger:** Activates after a configurable period of system-wide idle time (currently **5 minutes** for development, defaults to 15 minutes).
    - **Self-Awareness:** Ignores its own `system.notification.generated` events when calculating idle time to prevent reset loops.
    - **Coverage Tracking:** Updates progress based on the timestamp of the most recent event actually analyzed, ensuring no gaps in continuity.
    - **Memory:** Recalls the last **20 notifications** generated to avoid duplicate reporting and track issue resolution.
    - **Full Visibility:** Can query system logs, service status, and event history to perform deep root-cause analysis.
- **Notification UI:**
    - **Conditional Read Status:** Notifications remain "Unread" (Blue border) until manually expanded by the user.
    - **Persistence:** Read notifications (Grey or Priority-colored border) remain visible for **24 hours** from the moment they are marked as read.
    - **Blueprints Tab:** A dedicated tab for architectural theory, code design, and "Blueprints" generated by the AI (Purple border, JetBrains Mono formatting).

## Overall To-Do List

1.  **Analyst Reasoning Evolution**
    *   [x] Implement **Sentry Protocol** reasoning (Guardian).
    *   [x] Implement **Alert Review Protocol** reasoning logic (Imaginator).
    *   [x] Implement **Synthesis Protocol** profiling logic (Analyzer).

2.  **Dashboard Actionability**
    *   [ ] **Actionable Notifications:** Clicking a notification jumps to the relevant event in the timeline or specific log section.
    *   [x] **Turn-by-Turn History:** Bot messages now show the exact System/User/Assistant context slides in the dashboard.

3.  **System Stability**
    *   [x] Implement **Global Cognitive Lock** (`system:cognitive_lock`) to prevent agent overlap.
    *   [x] Implement **Smart Context** summarization to prevent context pollution in long chats.

## Gemini Added Memories
- **Protocol Terminology:** Agent layers are strictly called **Protocols**.
- **Active Protocols (Jan 2026):**
    - **Sentry (Guardian):** Technical health and logs.
    - **Synthesis (Analyzer):** Biographical user profiles.
    - **Alert Review (Imaginator):** Blueprint generation from alerts.
- **System Context Synchronization:**
    - Profiles loaded from Redis are injected into the Master System Prompt for every interaction.
    - Analytical pass on every user message extracts "Signals" (Sentiment, Intent, Vibe).
- **Cognitive Safety:**
    - **Global Lock:** Enforces sequential execution of all heavy agent tasks.
    - **Smart History:** Summarizes messages 6-25 while keeping 1-5 raw to maintain focus.
    - **Repeat Penalty:** Hardcoded `1.3` penalty in all chat calls to stop repetitive behavior.
- **Frontend Observability:**
    - Bot response events now include high-fidelity performance metrics (token counts, load/eval durations).
    - Detailed Carousel UI for chat history in every bot sent message event.
- **Robust AI JSON Parsing:**
    - Standardized `CleanJSON` utility across all agents to handle markdown-wrapped responses.


## Concerns Raised

### 1. Build Performance (Medium Concern)
- **Status:** Partially addressed by adding `version` handling and git progress. However, large pushes to `easter.company` are still slow due to binary storage in Git.

### 2. Analyst Token Consumption (Low Concern)
- **Status:** Monitoring. Adding logs and status to the prompt increases context size significantly.

### 3. Notification Fatigue (Medium Concern)
- **Status:** Addressed via deduplication logic and unread status persistence.