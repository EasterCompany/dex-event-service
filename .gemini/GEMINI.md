## Project Architecture & Constraints
- **Project Structure (Dec 2025):**
    - `dex-cli/` (Go): CLI management tool.
    - `dex-discord-service/` (Go): Discord bot, audio streaming, and VAD.
    - `dex-event-service/` (Go): Core event bus, storage, and handlers.
    - `dex-tts-service/` (Python/Go Wrapper): High-quality Text-to-Speech (XTTS-v2).
    - `dex-web-service/` (Go): Headless browser and metadata extraction.
    - `easter.company/` (HTML/JS): Frontend dashboard.
- **Restricted Channels:**
    - Channels `1437617331529580614` (music) and `1381915374181810236` (memes) are designated for analysis and moderation only. 
    - Dexter should explicitly avoid replying or engaging in these channels unless specifically mentioned.

## Analyst & Notifications System (Dec 2025)
- **Objective:** Establish a robust infrastructure for proactive AI insights and architectural "Blueprints."
- **Analyst Worker:**
    - **Trigger:** Activates after a configurable period of system-wide idle time (currently **5 minutes** for development, defaults to 15 minutes).
    - **Self-Awareness:** Ignores its own `system.notification.generated` events when calculating idle time to prevent reset loops.
    - **Coverage Tracking:** Updates progress based on the timestamp of the most recent event actually analyzed, ensuring no gaps in continuity.
    - **Memory:** Recalls the last **20 notifications** generated to avoid duplicate reporting and track issue resolution.
    - **Full Visibility:** Can query system logs, service status, and event history to perform deep root-cause analysis (Tier 1).
- **Notification UI:**
    - **Conditional Read Status:** Notifications remain "Unread" (Blue border) until manually expanded by the user.
    - **Persistence:** Read notifications (Grey or Priority-colored border) remain visible for **24 hours** from the moment they are marked as read.
    - **Blueprints Tab:** A dedicated tab for architectural theory, code design, and "Blueprints" generated by the AI (Purple border, JetBrains Mono formatting).

## Overall To-Do List

1.  **Analyst Reasoning Evolution**
    *   [x] Implement **Sentry Protocol (Tier 1)** reasoning.
    *   [ ] Implement **Architect Protocol (Tier 2)** reasoning logic.
    *   [ ] Implement **Strategist Protocol (Tier 3)** reasoning logic.
    *   [ ] Implement **Visionary Protocol (Tier 4)** deep work.

2.  **Dashboard Actionability**
    *   [ ] **Actionable Notifications:** Clicking a notification jumps to the relevant event in the timeline or specific log section.
    *   [ ] **Blueprint Persistence:** Ensure blueprints persist in the tab based on specific relevance rather than simple time-based expiry.

3.  **System Stability**
    *   [x] Fix Analyst Worker idle detection reset loop.
    *   [x] Resolve build process hangs and circular dependencies.
    *   [ ] Resolve versioning discrepancy in `dex-tts-service` (ensure built version is reported).

## Gemini Added Memories
- **Protocol Terminology:** Agent layers are now called **Protocols**.
- **Guardian Specifics:**
    - Tier 1: **Sentry Protocol**
    - Tier 2: **Architect Protocol**
- **System Context Synchronization:**
    - Implemented a centralized `dex-event-service/utils/system_context.go` for master system prompts.
    - Integrated these master prompts into `publicmessage`, `privatemessage`, and `analyst` handlers, ensuring consistent system awareness across all cognitive tasks.
- **Frontend "Blueprints" Integration:**
    - Added a **Blueprints** tab to the dashboard (positioned second in tab order).
    - Implemented `system.blueprint.generated` event type and frontend rendering logic in `blueprints.js`.
- **Analyst Worker "Sentry Protocol" Evolution:**
    - Implemented technical sentry logic focusing on service crashes, build errors, and technical anomalies.
    - Added "Recent Reported Issues" history to the analyst's reasoning loop.
    - Granted the analyst access to service status and the last 20 lines of service logs.
- **Build Process Safety & Observability:**
    - **Build Blocker:** `dex build` now checks for active processes in Redis and waits for them to finish (unless `--force` is used).
    - **Fast Version Reporting:** Added `version` command handling to `dex-tts-service` to prevent expensive Python environment initialization during builds.
    - **Git Progress:** Modified `dex-cli` to show real-time progress during Git pushes to `easter.company`, preventing "frozen" build appearances.
- **Robust AI JSON Parsing:**
    - Implemented multi-format JSON extraction logic in the Analyst Worker to handle raw arrays, wrapped objects, and markdown-wrapped AI responses.
    - Added validation to filter out empty or repetitive log-dump notifications.

## Concerns Raised

### 1. Build Performance (Medium Concern)
- **Status:** Partially addressed by adding `version` handling and git progress. However, large pushes to `easter.company` are still slow due to binary storage in Git.

### 2. Analyst Token Consumption (Low Concern)
- **Status:** Monitoring. Adding logs and status to the prompt increases context size significantly.

### 3. Notification Fatigue (Medium Concern)
- **Status:** Addressed via deduplication logic and unread status persistence.
